<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Tailoring Engine ✨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .prose h1 { font-size: 1.875rem; font-weight: 700; margin-bottom: 1rem; }
        .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
        .prose ul { list-style-position: inside; padding-left: 0; }
        .prose li { margin-bottom: 0.5rem; }
        .prose strong { font-weight: 600; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 90%;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Resume Tailoring Engine ✨</h1>
            <p class="text-lg text-gray-600 mt-2">Your AI-powered career assistant.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">1. Paste Job Description</h2>
                <textarea id="jobDescription" class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="Paste the full job description here..."></textarea>
                <div class="flex space-x-4 mt-4">
                    <button id="analyzeBtn" class="w-1/2 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition duration-200 flex items-center justify-center disabled:bg-gray-400">
                        ✨ Analyze Job
                    </button>
                    <button id="generateBtn" class="w-1/2 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200 flex items-center justify-center disabled:bg-gray-400">
                        Generate Resume
                    </button>
                </div>
            </div>

            <!-- Output Section -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800">2. Generated Content</h2>
                    <button id="copyBtn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition duration-200 hidden">
                        Copy
                    </button>
                </div>
                <div id="loader" class="hidden flex justify-center items-center h-full">
                    <div class="loader"></div>
                </div>
                <div id="resumeOutput" class="prose max-w-none flex-grow overflow-y-auto p-4 border border-gray-200 rounded-lg">
                    <p class="text-gray-500">Your tailored resume will appear here...</p>
                </div>
                <!-- Gemini Features Section -->
                <div id="nextSteps" class="hidden mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h3 class="text-xl font-semibold text-blue-800 mb-3">Next Steps ✨</h3>
                    <div class="flex space-x-4">
                        <button id="coverLetterBtn" class="flex-1 bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200">Draft Cover Letter</button>
                        <button id="interviewPrepBtn" class="flex-1 bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-200">Interview Prep</button>
                    </div>
                </div>
                 <div id="error-message" class="hidden mt-4 p-4 bg-red-100 text-red-700 rounded-lg"></div>
            </div>
        </main>
    </div>

    <!-- Modal for Gemini Features -->
    <div id="modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modalTitle" class="text-2xl font-semibold"></h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="modalLoader" class="hidden flex justify-center items-center py-16"><div class="loader"></div></div>
            <div id="modalBody" class="prose max-w-none"></div>
        </div>
    </div>

    <script type="module">
        // --- MASTER PROFILE DATABASE (minified for brevity) ---
        const masterProfile = {"contactInfo":{"name":"Mayur Mehta","phone":"+1 (571) 528-7448","email":"mayurdmehta@gmail.com","location":"Nashua, NH","linkedin":"[LinkedIn Profile URL]"},"experience":[{"company":"Robert Half","title":"Senior Business Systems Analyst","dates":"Dec 2022 – Mar 2025","accomplishments":[{"id":"RH01","summary":"Unified siloed global marketing teams..."},{"id":"RH02","summary":"Resolved team inefficiency..."},{"id":"RH03","summary":"Owned the Invoca call intelligence platform..."},{"id":"RH04","summary":"Served as the central operational leader..."},{"id":"RH05","summary":"Led the project to migrate the 200+ user..."}]},{"company":"LilacMosaic Technologies","title":"Co-Founder / Lead Business Analyst","dates":"Aug 2023 – Jan 2025","accomplishments":[{"id":"LM01","summary":"As co-founder, drove the end-to-end product discovery..."},{"id":"LM02","summary":"Oversaw the integration of Hugging Face (GenAI)..."},{"id":"LM03","summary":"Enabled a nimble startup team to thrive..."}]},{"company":"Akamai Technologies","title":"Business Systems Analyst","dates":"Sep 2019 – Dec 2022","accomplishments":[{"id":"AK01","summary":"Led a 7-phase global program to modernize..."},{"id":"AK02","summary":"Drove a complex, SOX-compliant expense system..."},{"id":"AK03","summary":"Automated the transmission of $1B in annual vendor payments..."},{"id":"AK04","summary":"Increased cross-functional operational efficiency by 25%..."}]}],"education":[{"institution":"Northeastern University","degree":"Master of Science, Engineering Management","gpa":"3.9"},{"institution":"University of Mumbai","degree":"Bachelor of Science, Computer Science"}],"certifications":[{"name":"Certified Scrum Master (CSM)","issuer":"Scrum Alliance","status":"Completed: Apr 2025"},{"name":"AWS Certified Cloud Practitioner","issuer":"AWS","status":"In Progress, Expected: Jul 2025"},{"name":"Project Management Professional (PMP)","issuer":"PMI","status":"In Progress, Expected: Aug 2025"}],"skills_master_list":["Agile","Scrum","Kanban","Waterfall","SDLC", "etc..."]};

        // --- DOM ELEMENTS ---
        const generateBtn = document.getElementById('generateBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const jobDescriptionInput = document.getElementById('jobDescription');
        const resumeOutput = document.getElementById('resumeOutput');
        const loader = document.getElementById('loader');
        const copyBtn = document.getElementById('copyBtn');
        const errorMessageDiv = document.getElementById('error-message');
        const nextSteps = document.getElementById('nextSteps');
        const coverLetterBtn = document.getElementById('coverLetterBtn');
        const interviewPrepBtn = document.getElementById('interviewPrepBtn');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalLoader = document.getElementById('modalLoader');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // --- EVENT LISTENERS ---
        generateBtn.addEventListener('click', () => callGeminiForResume('resume'));
        analyzeBtn.addEventListener('click', () => callGeminiForResume('analyze'));
        coverLetterBtn.addEventListener('click', draftCoverLetter);
        interviewPrepBtn.addEventListener('click', generateInterviewQuestions);
        closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

        // --- CORE LOGIC ---
        function formatForDisplay(text) {
             let html = text
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^\* (.*$)/gim, '<li>$1</li>');
            html = html.replace(/<li>/g, '<ul><li>').replace(/<\/li>/g, '</li></ul>').replace(/<\/ul>\s*<ul>/g, '');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            return html.replace(/\n/g, '<br>');
        }

        async function callGeminiAPI(prompt) {
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = "AIzaSyAP-sXBNvG-538xPx7zfKB1UBxwa_uqins"; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error("Invalid response structure from API.");
            }
        }

        async function callGeminiForResume(mode) {
            const jobDescription = jobDescriptionInput.value;
            if (!jobDescription.trim()) {
                showError("Please paste a job description.");
                return;
            }
            setLoading(true);

            const analysisPrompt = `Analyze the following job description and produce a structured JSON "Blueprint" containing: \`targetRole\`, \`top5HardSkills\`, \`top3CulturalTraits\`, \`writingStyle\`, and \`coreProblem\`. \n\n**Job Description:**\n\`\`\`${jobDescription}\`\`\``;
            
            const resumeGenerationPrompt = `
You are an advanced AI resume tailoring engine. Based on the provided Master Profile Database and the Job Description, create a perfectly tailored resume.

**//-- START OF PROCESS --//**

**1. GIVEN:**
   - **The \`Master Profile Database\`:** ${JSON.stringify(masterProfile)}
   - **The \`Job Description\`:** \`\`\`${jobDescription}\`\`\`

**2. EXECUTE:**
   - Analyze the job description to create a blueprint.
   - Score and select the most relevant accomplishments from the database.
   - Generate a new professional summary and core competencies section.
   - Rewrite the selected accomplishment summaries following these strict rules:
     - **Tone:** Match the job description's tone.
     - **Structure:** \`[Result/Quantifiable Metric]\` -> \`by [Task/Action]\` -> \`[Outcome/Business Objective/Method]\`.
     - **Clarity & Length:** Use simple language, max two lines per bullet.
   - Assemble the final resume in Markdown with the correct bullet counts (RH:5, LM:3, AK:5).
   - Verify for 100% accuracy against the source data. No hallucinations.

**//-- END OF PROCESS --//**

**EXPECTED OUTPUT:**
A complete, tailored resume in Markdown format, starting with the name.
`;

            try {
                const prompt = mode === 'analyze' ? analysisPrompt : resumeGenerationPrompt;
                const resultText = await callGeminiAPI(prompt);
                
                resumeOutput.innerHTML = formatForDisplay(resultText);
                copyBtn.classList.remove('hidden');
                if (mode === 'resume') {
                    nextSteps.classList.remove('hidden');
                } else {
                    nextSteps.classList.add('hidden');
                }
            } catch (error) {
                console.error("Error:", error);
                showError("Sorry, an error occurred. Please try again.");
            } finally {
                setLoading(false);
            }
        }

        async function draftCoverLetter() {
            openModal("✨ Cover Letter Draft");
            const jobDescription = jobDescriptionInput.value;
            const resumeText = resumeOutput.innerText;
            
            const prompt = `You are a professional career coach. Based on the provided Job Description and the candidate's Tailored Resume, write a concise and professional cover letter. It should be 3-4 paragraphs. Highlight 2-3 of the most relevant accomplishments from the resume and connect them directly to the job's core requirements. Maintain a confident but humble tone. Address it to the 'Hiring Team'.

**Job Description:**
\`\`\`${jobDescription}\`\`\`

**Tailored Resume:**
\`\`\`${resumeText}\`\`\``;

            try {
                const resultText = await callGeminiAPI(prompt);
                modalBody.innerHTML = formatForDisplay(resultText);
            } catch (error) {
                modalBody.innerHTML = `<p class="text-red-500">Failed to generate cover letter.</p>`;
            } finally {
                modalLoader.classList.add('hidden');
            }
        }

        async function generateInterviewQuestions() {
            openModal("✨ Interview Prep Questions");
            const jobDescription = jobDescriptionInput.value;
            const resumeText = resumeOutput.innerText;
            
            const prompt = `You are the hiring manager for the role in the Job Description below. You are preparing to interview the candidate whose resume is also provided. Generate a list of 6 insightful interview questions. Include a mix of behavioral questions (using the STAR method format) and questions that probe their technical and program management experience. The questions should be specific to the resume and the job requirements.

**Job Description:**
\`\`\`${jobDescription}\`\`\`

**Tailored Resume:**
\`\`\`${resumeText}\`\`\``;
            
            try {
                const resultText = await callGeminiAPI(prompt);
                modalBody.innerHTML = formatForDisplay(resultText);
            } catch (error) {
                modalBody.innerHTML = `<p class="text-red-500">Failed to generate questions.</p>`;
            } finally {
                modalLoader.classList.add('hidden');
            }
        }

        // --- UI HELPER FUNCTIONS ---
        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            analyzeBtn.disabled = isLoading;
            if (isLoading) {
                resumeOutput.classList.add('hidden');
                loader.classList.remove('hidden');
                errorMessageDiv.classList.add('hidden');
                nextSteps.classList.add('hidden');
            } else {
                resumeOutput.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }
        
        function openModal(title) {
            modalTitle.textContent = title;
            modal.classList.remove('hidden');
            modalBody.innerHTML = '';
            modalLoader.classList.remove('hidden');
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
        }

        function copyToClipboard() {
            const textToCopy = resumeOutput.innerText;
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyBtn.textContent = 'Copied!';
                setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showError("Failed to copy text.");
            }
            document.body.removeChild(textArea);
        }

    </script>
</body>
</html>
